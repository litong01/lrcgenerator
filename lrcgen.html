<!DOCTYPE html>
<html>
<head>
  <title>Lyrics lrc generator</title>
  <style>
  .buttonLyrics {
    font-wight: bold;
    font-size: large;
    font-family: Verdana;
  }

  .buttonNormal {
    font-wight: normal;
    font-size: medium;
    font-family: Verdana;
  }

  .inputText {
    outline: none !important;
    border:1px solid #0099cc;
    box-shadow: 0 0 10px #719ECE;
  }

  textarea {
    outline: none !important;
    border:2px solid #66ccff;
    box-shadow: 0 0 10px #719ECE;
    resize: vertical;
  }

  </style>
  <script type="text/javascript">
    function format_time(s) {
      s = s / 1000;
      var hours = Math.floor(s / 3600);
      var minutes = Math.floor((s / 60) % 60);
      var seconds = Math.floor(s % 60);
      hours = hours < 10 ? "0" + hours : hours;
      minutes = minutes < 10 ? "0" + minutes : minutes;
      seconds = seconds < 10 ? "0" + seconds : seconds;
      return minutes + ":" + seconds;
    }

    function getVLC() {
      return document.getElementById("vlc");
    }

    function registerVLCEvent(event, handler) {
      var vlc = getVLC();
      if (vlc) {
        vlc.addEventListener(event, handler, false);
      }
    }

    function unregisterVLCEvent(event, handler) {
      var vlc = getVLC();
      if (vlc) {
        vlc.removeEventListener(event, handler, false);
      }
    }

    function handle_MediaPlayerTimeChange(val){
      document.getElementById('timemark').value = "" + format_time(val);
    }

    function updateVolume(deltaVol) {
      var vlc = getVLC();
      vlc.audio.volume += deltaVol;
    }

    function doPlay() {
      var vlc = getVLC();
      if ( vlc.playlist.isPlaying ) {
        vlc.playlist.pause();
        document.getElementById("btn_play").value = "play ";
      } else {
        vlc.playlist.play()
        document.getElementById("btn_play").value = "pause";
      }
    }

    function doLyrics() {
      var vlc = getVLC();
      var mark = vlc.input.time;
      var m_v = Math.floor(mark/60000).toFixed(0);
      m_v = (m_v>9)?m_v:'0'+m_v;
      var s_v = (mark/1000%60).toLocaleString('en-US',
         {minimumIntegerDigits:2, maximumFractionDigits:2, useGrouping:false});
      var llc = document.getElementById("lyrics");
      var new_pos = llc.selectionStart;
      llc.value = llc.value.substr(0,new_pos) + "[" + m_v + ":" + s_v + "]" + llc.value.substr(new_pos);
      llc.selectionStart = llc.value.indexOf('\n', new_pos+8)+1;
      while (llc.value.substr(llc.selectionStart, 1) == '[') {
        llc.selectionStart = llc.value.indexOf(']', llc.selectionStart) + 1;
      }
      llc.selectionEnd = llc.selectionStart;
    }

    function doNew() {
      var vlc = getVLC();
      var newfile = document.getElementById("songname").value;
      vlc.playlist.items.clear();
      var itemId=vlc.playlist.add(newfile);
      pos0 = newfile.lastIndexOf('/');
      pos1 = newfile.lastIndexOf('.');
      llc = document.getElementById("lyrics");
      llc.value = '[ti:' + newfile.substr(pos0+1, pos1-pos0-1) + ']\n' + llc.value;
      llc.selectionStart = llc.value.indexOf('\n', 5)+1;
      llc.selectionEnd = llc.selectionStart;
      doPlay();
    }

    function doStart() {
      registerVLCEvent("MediaPlayerTimeChanged", handle_MediaPlayerTimeChange);
    }

    var helpMsg = "Copy a song's text lyrics in the lyric box, copy song url" +
      " in the link box, move the cursor in the lyric box to the very begining of" +
      " the text, then click on the start button, then click on the lyric button" +
      " to add the time mark to the lyric when the time is right.";

    function doHelp() {
      alert(helpMsg);
    }
  </script>
</head>
<body onload="doStart();">
<table cellpadding="4" cellspacing="0" style="table-layout:fixed; overflow:hidden">
<col width="100px" />
<col width="40px" />
<tr><td colspan="2" align="center">
LRC Generator
</td></tr>
<tr><td colspan="2">
<embed type="application/x-vlc-plugin" pluginspage="http://www.videolan.org"
       width="540" height="30" id="vlc" controls="true" autostart="false"
       allowfullscreen="false" branding="true" />
</td></tr>
<tr><td>
<span class="buttonNormal">link:&nbsp;</span><input type=text id="songname" size="50" class="inputText"/>
</td><td align="right">
<input type=button value="start" onclick='doNew();' class="buttonLyrics" />
</td></tr>
<tr><td colspan="2">
<input type=button id="btn_play" value=" play " onClick='doPlay();' class="buttonNormal" />
<input type=button value="mute" onclick=' vlc.audio.togglemute();' class="buttonNormal" />
<input type=button value="volume-" onclick='updateVolume(-10);' class="buttonNormal" />
<input type=button value="volume+" onclick='updateVolume(+10);' class="buttonNormal" />
<input type=button value="help" onclick='doHelp();' class="buttonNormal" />
</td></tr>
<tr><td>
<span class="buttonNormal">current time:&nbsp;</span><input type=text id="timemark" value="0:0.0" disabled class="buttonNormal" />
</td><td align="right">
<input type=button value="lyrics" onClick='doLyrics();' class="buttonLyrics" />
</td></tr>
<tr><td colspan="2" align="center">
  <textarea id="lyrics" rows="30" cols="60" style="width:98%"></textarea>
</td></tr>
</table>
</body>
</html>
